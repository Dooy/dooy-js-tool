/*!
 * version: 0.1.3
 * docs: https://github.com/Dooy/dooy-js-tool
 * 
 */!function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=1)}([function(t,e){const r={dateFormat(t,e){let r=new Date;return arguments.length<=1||(r=this.parseDate(e)),this.dateFormatDone(t,r)},parseDate(t){try{if("number"==typeof t&&t>0)return new Date(1e3*t);if("string"==typeof t){if(Date.parse(t))return new Date(t)}else if(t.constructor==Date)return t}catch(t){}throw"必须是时间戳、日期字符、时间类型三者其一"},dateFormatDone:(t,e)=>(Date.prototype.format=function(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var r in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),e)new RegExp("("+r+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[r]:("00"+e[r]).substr((""+e[r]).length)));return t},e.format(t)),timeToDate(t,e){let r=new Date(1e3*t);return this.dateFormatDone(e,r)},nowStr(t){let e=Math.round(new Date/1e3),r=e-t;return r<120?"刚刚":r<1800?Math.round(r/60)+"分钟前":r<2400?"半小时前":this.timeToDate(e,"yyyy-MM-dd")==this.timeToDate(t,"yyyy-MM-dd")?r<43200?Math.round(r/3600)+"小时前":this.timeToDate(t,"hh:mm"):r<172800?"1天前":r<259200?"2天前":r<345600?"3天前":this.timeToDate(t,"yyyy-MM-dd")},now(t){let e=Math.round(this.parseDate(t)/1e3);return this.nowStr(e)},getQueryStr(t){var e,r=location.href;return(e=new RegExp("(^|)"+t+"=([^&]*)(&|$)","gi").exec(r))?e[2]:""},isFunction:t=>"function"==typeof t,isDefined:t=>!(void 0===t),isObject:t=>"object"==typeof t,inArray(t,e){for(let r in e)if(e[r]===t)return!0;return!1},extend(t,e){const r=t;if(!this.isObject(e))return r;for(let t in e){if(this.isDefined(r[t]))this.inArray(1,[1,3])&&(r[t]=e[t]);else{this.inArray(1,[2,3])&&(r[t]=e[t])}}return r}};t.exports=r},function(t,e,r){"use strict";var n=r(0),o=r(2);t.exports={tool:n,cos:{init:function(t){t.COS,t.callback,t.stsMyServer,t.cosCdn,t.Bucket,t.Region;return new o(arguments[0])}}},window.dooy={tool:n,cos:{init:function(t){t.COS,t.callback,t.stsMyServer,t.cosCdn,t.Bucket,t.Region;return new o(arguments[0])}}}},function(t,e,r){const n=r(0);t.exports=class{constructor({COS:t,callback:e,stsMyServer:r,cosCdn:o,Bucket:i,Region:s}){this.COS=t,this.config={callback(){},stsMyServer:"/?c=mpad&a=cos&do=1",cosCdn:"//cos.pigai.org",Bucket:"pigaicos-1255341547",Region:"ap-nanjing"},this.initRdate(),arguments.length>0&&n.extend(this.config,arguments[0])}initRdate(){this.rdata={error:0,error_des:"",data:{}}}upload(t,{callFun:e,onProgress:r}){if(this.initRdate(),n.isFunction(e)&&(this.config.callback=e),arguments.length>2)for(let t in arguments[2])config[t]&&(config[t]=arguments[2][t]);let o=this.getCos(e),i=t.name,s=i.substring(i.lastIndexOf("."));if(!this.getExt(s))return!1;var a=this.getFileName(s);console.log("fname>>",a),o.uploadFile({Bucket:this.config.Bucket,Region:this.config.Region,Key:a,Body:t,SliceSize:15728640,onProgress:t=>{n.isFunction(r)&&r(t)}},(e,r)=>{if(console.log("上传"+(e?"失败":"完成")),console.log("uploadFile:",e||r),e)this.error(404,"上传失败 ["+e+"]");else{let e={f:a,fdes:t.name,fhttp:this.config.cosCdn+"/"+a};this.success(e)}})}getCos(){return new this.COS({getAuthorization:(t,e)=>{var r=this.config.stsMyServer,n=new XMLHttpRequest;n.open("GET",r,!0),n.onload=t=>{try{var r=JSON.parse(t.target.responseText),n=(r=r.Response).Credentials}catch(t){}if(!r||!n)return this.error(401,"凭证错误"),console.error("credentials invalid:\n"+JSON.stringify(r,null,2));e({TmpSecretId:n.TmpSecretId,TmpSecretKey:n.TmpSecretKey,SecurityToken:n.Token,ExpiredTime:r.ExpiredTime})},n.send()}})}getFileName(t){return"cup/"+n.dateFormat("yyyy/MM/dd")+"/"+function(t){let e=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];for(var r="",n=0;n<t;n++){r+=e[Math.ceil(35*Math.random())]}return r}(8)+t}getExt(t){let e="doc,docx,ppt,ppt,xls,xxls,xlsx,vsd,pot,pps,rtf,wps,et,dps,pdf,rar,zip,tgz,tar,jpg,png,gif,jpe,jpeg".split(",");for(let r in e){if("."+e[r]==t.toLocaleLowerCase())return!0}return this.error(402,t+" 格式不支持"),!1}error(t,e){this.rdata.error=t,this.rdata.error_des=e,this.rdata.data={},this.doCallBack()}success(t){this.rdata.error=0,this.rdata.error_des="",this.rdata.data=t,this.doCallBack()}doCallBack(){this.config.callback(this.rdata)}}}]);