/*!
 * version: 0.1.4
 * docs: https://github.com/Dooy/dooy-js-tool
 * 
 */!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t){const r={dateFormat(e,t){let r=new Date;return arguments.length<=1||(r=this.parseDate(t)),this.dateFormatDone(e,r)},parseDate(e){try{if("number"==typeof e&&e>0)return new Date(1e3*e);if("string"==typeof e){if(Date.parse(e))return new Date(e)}else if(e.constructor==Date)return e}catch(e){}throw"必须是时间戳、日期字符、时间类型三者其一"},dateFormatDone:(e,t)=>(Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var r in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+r+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[r]:("00"+t[r]).substr((""+t[r]).length)));return e},t.format(e)),timeToDate(e,t){let r=new Date(1e3*e);return this.dateFormatDone(t,r)},nowStr(e){let t=Math.round(new Date/1e3),r=t-e;return r<120?"刚刚":r<1800?Math.round(r/60)+"分钟前":r<2400?"半小时前":this.timeToDate(t,"yyyy-MM-dd")==this.timeToDate(e,"yyyy-MM-dd")?r<43200?Math.round(r/3600)+"小时前":this.timeToDate(e,"hh:mm"):r<172800?"1天前":r<259200?"2天前":r<345600?"3天前":this.timeToDate(e,"yyyy-MM-dd")},now(e){let t=Math.round(this.parseDate(e)/1e3);return this.nowStr(t)},getQueryStr(e){var t,r=location.href;return(t=new RegExp("(^|)"+e+"=([^&]*)(&|$)","gi").exec(r))?t[2]:""},isFunction:e=>"function"==typeof e,isDefined:e=>!(void 0===e),isObject:e=>"object"==typeof e,inArray(e,t){for(let r in t)if(t[r]===e)return!0;return!1},extend(e,t){let r=1;arguments.length>2&&(r=arguments[2]);const n=e;if(!this.isObject(t))return n;for(let e in t){if(this.isDefined(n[e]))this.inArray(r,[1,3])&&(n[e]=t[e]);else{this.inArray(r,[2,3])&&(n[e]=t[e])}}return n}};e.exports=r},function(e,t,r){"use strict";var n=r(0),i=r(2),o=r(3);window.dooy={tool:n,es:{init:function(e){var t=e.axios;e.esServer;return console.log("ddddd",t),new o(arguments[0])}},cos:{init:function(e){e.COS,e.callback,e.stsMyServer,e.cosCdn,e.Bucket,e.Region;return new i(arguments[0])}}}},function(e,t,r){const n=r(0);e.exports=class{constructor({COS:e,callback:t,stsMyServer:r,cosCdn:i,Bucket:o,Region:s}){this.COS=e,this.config={callback(){},stsMyServer:"/?c=mpad&a=cos&do=1",cosCdn:"//cos.pigai.org",Bucket:"pigaicos-1255341547",Region:"ap-nanjing"},this.initRdate(),arguments.length>0&&n.extend(this.config,arguments[0])}initRdate(){this.rdata={error:0,error_des:"",data:{}}}upload(e,{callFun:t,onProgress:r}){if(this.initRdate(),n.isFunction(t)&&(this.config.callback=t),arguments.length>2)for(let e in arguments[2])config[e]&&(config[e]=arguments[2][e]);let i=this.getCos(t),o=e.name,s=o.substring(o.lastIndexOf("."));if(!this.getExt(s))return!1;var a=this.getFileName(s);console.log("fname>>",a),i.uploadFile({Bucket:this.config.Bucket,Region:this.config.Region,Key:a,Body:e,SliceSize:15728640,onProgress:e=>{n.isFunction(r)&&r(e)}},(t,r)=>{if(console.log("上传"+(t?"失败":"完成")),console.log("uploadFile:",t||r),t)this.error(404,"上传失败 ["+t+"]");else{let t={f:a,fdes:e.name,fhttp:this.config.cosCdn+"/"+a};this.success(t)}})}getCos(){return new this.COS({getAuthorization:(e,t)=>{var r=this.config.stsMyServer,n=new XMLHttpRequest;n.open("GET",r,!0),n.onload=e=>{try{var r=JSON.parse(e.target.responseText),n=(r=r.Response).Credentials}catch(e){}if(!r||!n)return this.error(401,"凭证错误"),console.error("credentials invalid:\n"+JSON.stringify(r,null,2));t({TmpSecretId:n.TmpSecretId,TmpSecretKey:n.TmpSecretKey,SecurityToken:n.Token,ExpiredTime:r.ExpiredTime})},n.send()}})}getFileName(e){return"cup/"+n.dateFormat("yyyy/MM/dd")+"/"+function(e){let t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];for(var r="",n=0;n<e;n++){r+=t[Math.ceil(35*Math.random())]}return r}(8)+e}getExt(e){let t="doc,docx,ppt,ppt,xls,xxls,xlsx,vsd,pot,pps,rtf,wps,et,dps,pdf,rar,zip,tgz,tar,jpg,png,gif,jpe,jpeg".split(",");for(let r in t){if("."+t[r]==e.toLocaleLowerCase())return!0}return this.error(402,e+" 格式不支持"),!1}error(e,t){this.rdata.error=e,this.rdata.error_des=t,this.rdata.data={},this.doCallBack()}success(e){this.rdata.error=0,this.rdata.error_des="",this.rdata.data=e,this.doCallBack()}doCallBack(){this.config.callback(this.rdata)}}},function(e,t,r){const n=r(0);class i{constructor(e){this.buckets=e}getObjectByKey(e){for(let t in this.buckets){let r=this.buckets[t];if(r.key==e)return r;if(void 0!==r.key_as_string&&r.key_as_string==e)return r}return null}init(e){return new i(e)}getValue(){let e=[];for(let t in this.buckets){let r=this.buckets[t],i={key:r.key_as_string||r.key,doc_count:r.doc_count};for(let e in r)n.isDefined(r[e].value)&&(i[e]=r[e].value);e.push(i)}return e}}e.exports=class{constructor({axios:e,esServer:t="/_sql"}){this.axios=e,this.esServer=t}request(e){return this.axios({headers:{"Content-Type":"application/json;charset=utf-8"},url:this.esServer,method:"post",responseType:"json",data:e})}createBuckets(e){return new i(arguments[0])}when(e,t){let r=[];for(let t in e)r.push(this.request(e[t]));let n=this.axios;return n.all(r).then(n.spread(t))}}}]);